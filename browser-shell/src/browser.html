<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src  'self';
                 style-src   'self';
                 img-src     'self' data: https: http://127.0.0.1:8080;
                 connect-src http://127.0.0.1:8080;" />
  <title>Intelli</title>
  <link rel="stylesheet" href="browser.css" />
</head>
<body>

  <!-- ── Tab bar ──────────────────────────────────────────────── -->
  <div id="tab-bar">
    <!-- Intelli logo — top-left brand mark; click returns home -->
    <div id="intelli-logo" title="Intelli — Home">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="22" height="22">
        <defs>
          <linearGradient id="ilbg" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#5b54e8"/>
            <stop offset="100%" stop-color="#a78bfa"/>
          </linearGradient>
        </defs>
        <rect width="32" height="32" rx="8" fill="url(#ilbg)"/>
        <rect x="0" y="0" width="32" height="16" rx="8" fill="white" opacity="0.07"/>
        <rect x="9.5" y="7.5" width="13" height="3" rx="1.5" fill="white" opacity="0.95"/>
        <rect x="9.5" y="21.5" width="13" height="3" rx="1.5" fill="white" opacity="0.95"/>
        <rect x="14.5" y="10" width="3" height="4.5" rx="1.2" fill="white" opacity="0.82"/>
        <rect x="14.5" y="17.5" width="3" height="4.5" rx="1.2" fill="white" opacity="0.82"/>
        <line x1="16" y1="16" x2="9.5"  y2="11.5" stroke="white" stroke-opacity="0.28" stroke-width="1.1" stroke-linecap="round"/>
        <line x1="16" y1="16" x2="22.5" y2="11.5" stroke="white" stroke-opacity="0.28" stroke-width="1.1" stroke-linecap="round"/>
        <line x1="16" y1="16" x2="9.5"  y2="20.5" stroke="white" stroke-opacity="0.28" stroke-width="1.1" stroke-linecap="round"/>
        <line x1="16" y1="16" x2="22.5" y2="20.5" stroke="white" stroke-opacity="0.28" stroke-width="1.1" stroke-linecap="round"/>
        <circle cx="16" cy="16" r="4" fill="white" opacity="0.88"/>
        <circle cx="16" cy="16" r="2.4" fill="#7c6ff5"/>
        <circle cx="15.2" cy="15.2" r="0.8" fill="white" opacity="0.55"/>
      </svg>
    </div>
    <div id="tabs"></div>
    <div class="tab-bar-spacer"></div>
    <!-- Custom window controls (titleBarStyle=hidden removes OS buttons) -->
    <div id="win-controls">
      <button class="wc-btn" id="btn-win-min"   title="Minimize">&#8211;</button>
      <button class="wc-btn" id="btn-win-max"   title="Maximize">&#9633;</button>
      <button class="wc-btn" id="btn-win-close" title="Close">&#10005;</button>
    </div>
  </div>

  <!-- ── Address / navigation bar ────────────────────────────── -->
  <div id="address-bar">
    <button class="nav-btn" id="btn-back"    title="Back (Alt+Left)">&#8592;</button>
    <button class="nav-btn" id="btn-forward" title="Forward (Alt+Right)">&#8594;</button>
    <button class="nav-btn" id="btn-reload"  title="Reload (Ctrl+R)">&#8635;</button>
    <button class="nav-btn" id="btn-home"    title="Home">&#8962;</button>
    <button class="nav-btn" id="new-tab-btn" title="Nouvel onglet (Ctrl+T)">&#43;</button>

    <div id="url-wrap">
      <div id="gw-dot" class="loading" title="Gateway status"></div>
      <input id="url-input" type="text" spellcheck="false"
             placeholder="Search or enter address" autocomplete="off" />
      <!-- bookmark star inside url bar -->
      <button id="btn-bookmark-star" class="url-action-btn" title="Bookmark this tab (Ctrl+D)">&#9734;</button>
    </div>

    <!-- zoom indicator (hidden when at 100%) -->
    <div id="zoom-indicator" class="hidden">
      <button id="btn-zoom-out"   class="zoom-step" title="Zoom out">&#8722;</button>
      <span   id="zoom-pct">100%</span>
      <button id="btn-zoom-in"    class="zoom-step" title="Zoom in">&#43;</button>
      <button id="btn-zoom-reset" class="zoom-reset-btn" title="Reset zoom">&#10006;</button>
    </div>

    <button class="nav-btn" id="btn-sidebar"
            title="AI Chat sidebar (Ctrl+Shift+A)" aria-label="Toggle AI Chat sidebar">&#9776;</button>

    <!-- Onglets inactifs button -->
    <button id="btn-tab-groups" class="nav-btn hidden" tabindex="-1"
            title="Onglets inactifs (Ctrl+Shift+G)">&#128564;<span id="tg-badge" class="tg-badge" style="display:none">0</span></button>

    <!-- three-dot menu -->
    <button class="nav-btn" id="btn-app-menu"
            title="Intelli menu">&#8942;</button>
  </div>

  <!-- ── Bookmarks bar ─────────────────────────────────────────── -->
  <div id="bookmarks-bar" class="hidden"></div>

  <!-- Update notification bar — hidden until an update is available -->
  <div id="update-bar" class="hidden">
    <span id="update-msg">Update available: <strong id="update-version"></strong></span>
    <div class="update-actions">
      <button id="btn-update-install" class="update-btn-primary">Restart &amp; Install</button>
      <button id="btn-update-dismiss" class="update-btn-dismiss">&#10005;</button>
    </div>
  </div>

  <!-- ══════════════════════════════════════════════════════════
       PANELS — slide in from the right, rendered above BrowserViews
       because they are part of the chrome renderer (not a BrowserView).
       They are absolutely positioned relative to the body.
       ══════════════════════════════════════════════════════════ -->

  <!-- Bookmark star tooltip / quick-add -->
  <div id="panel-bookmarks" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-title">Bookmarks</span>
      <button class="panel-close" id="bm-panel-close">&#10005;</button>
    </div>
    <!-- quick-add form (shown when bookmarking current page) -->
    <div id="bm-quick-add" class="hidden">
      <div class="panel-section-label">Bookmark added</div>
      <label class="field-label">Name</label>
      <input id="bm-name-input" class="panel-input" type="text" />
      <div class="panel-row">
        <button id="bm-save-btn"   class="btn-primary">Done</button>
        <button id="bm-remove-btn" class="btn-danger">Remove</button>
      </div>
    </div>
    <!-- bookmark list -->
    <div class="panel-section-label">All Bookmarks</div>
    <input id="bm-search" class="panel-input" type="text" placeholder="Search bookmarks…" />
    <div id="bm-list" class="panel-list"></div>
  </div>

  <!-- History panel -->
  <div id="panel-history" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-title">History</span>
      <button class="panel-close" id="hist-panel-close">&#10005;</button>
    </div>
    <div class="panel-row">
      <input id="hist-search" class="panel-input" type="text" placeholder="Search history…" style="flex:1" />
      <button id="hist-clear-btn" class="btn-danger" style="flex-shrink:0">Clear all</button>
    </div>
    <div id="hist-list" class="panel-list"></div>
  </div>

  <!-- Settings panel -->
  <div id="panel-settings" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-title">Settings</span>
      <button class="panel-close" id="settings-panel-close">&#10005;</button>
    </div>
    <div class="panel-section-label">Appearance</div>
    <div class="settings-row">
      <span>Theme</span>
      <select id="setting-theme" class="panel-select">
        <option value="dark">Dark</option>
        <option value="light">Light (coming soon)</option>
      </select>
    </div>
    <div class="settings-row">
      <span>New tab page</span>
      <select id="setting-newtab" class="panel-select">
        <option value="duckduckgo" selected>DuckDuckGo</option>
        <option value="google">Google</option>
        <option value="brave">Brave Search</option>
        <option value="custom">URL personnalisée…</option>
      </select>
    </div>
    <div class="settings-row" id="setting-newtab-custom-row" style="display:none">
      <input type="text" id="setting-newtab-custom-url" class="panel-input"
             placeholder="https://…" style="flex:1;min-width:0" />
      <button class="btn-primary" id="setting-newtab-save" style="flex-shrink:0">✓</button>
    </div>
    <div class="panel-section-label" style="margin-top:16px">Gateway</div>
    <div class="settings-row">
      <span>Admin Hub</span>
      <button class="btn-primary" id="setting-open-hub">Open</button>
    </div>
    <div class="settings-row">
      <span>Extensions</span>
      <button class="btn-primary" id="setting-open-addons">Manage Addons</button>
    </div>
    <div class="settings-row">
      <span>Downloads folder</span>
      <button class="btn-primary" id="setting-open-downloads">Open Folder</button>
    </div>
    <div class="panel-section-label" style="margin-top:16px">Developer</div>
    <div class="settings-row">
      <span>DevTools (page)</span>
      <button class="btn-primary" id="setting-devtools-page">Open</button>
    </div>
    <div class="settings-row">
      <span>DevTools (chrome)</span>
      <button class="btn-primary" id="setting-devtools-chrome">Open</button>
    </div>

    <!-- ── Barre de favoris ────────────────────────────────────── -->
    <div class="panel-section-label" style="margin-top:16px">Barre de favoris</div>
    <div class="settings-row">
      <span>Afficher la barre de favoris</span>
      <label class="tg-switch">
        <input type="checkbox" id="setting-bookmarks-bar" />
        <span class="tg-slider"></span>
      </label>
    </div>

    <!-- ── Onglets groupés ──────────────────────────────────── -->
    <div class="panel-section-label" style="margin-top:16px">Onglets groupés</div>
    <div class="settings-row">
      <span>Activer le regroupement</span>
      <label class="tg-switch">
        <input type="checkbox" id="setting-tab-group-enabled" />
        <span class="tg-slider"></span>
      </label>
    </div>
    <div class="settings-row">
      <span>Regrouper après</span>
      <select id="setting-tab-group-delay" class="panel-select">
        <option value="1">1 minute</option>
        <option value="5" selected>5 minutes</option>
        <option value="15">15 minutes</option>
        <option value="30">30 minutes</option>
        <option value="60">1 heure</option>
        <option value="120">2 heures</option>
        <option value="720">12 heures</option>
        <option value="1440">24 heures</option>
        <option value="2880">48 heures</option>
      </select>
    </div>

  </div>

  <!-- Clear browsing data panel -->
  <div id="panel-clear-data" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-title">Clear browsing data</span>
      <button class="panel-close" id="clear-panel-close">&#10005;</button>
    </div>
    <div class="panel-section-label">Intelli Browser data</div>
    <label class="check-row"><input type="checkbox" id="clr-history"   checked /> Browsing history</label>
    <label class="check-row"><input type="checkbox" id="clr-bookmarks"          /> Bookmarks</label>
    <div class="panel-section-label" style="margin-top:12px">Web page data (clears for all sites)</div>
    <label class="check-row"><input type="checkbox" id="clr-cookies"   checked /> Cookies &amp; site data</label>
    <label class="check-row"><input type="checkbox" id="clr-cache"     checked /> Cached images &amp; files</label>
    <div class="panel-row" style="margin-top:16px">
      <button id="clr-cancel-btn" class="btn-secondary">Cancel</button>
      <button id="clr-clear-btn"  class="btn-danger">Clear data</button>
    </div>
  </div>

  <!-- Dev addons / local extension loader panel -->
  <div id="panel-dev-addons" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-title">Developer Addons</span>
      <button class="panel-close" id="devaddon-panel-close">&#10005;</button>
    </div>
    <div class="panel-section-label">Load unpacked addon</div>
    <p class="panel-hint">Paste JavaScript to inject into the active page. It runs immediately and is also queued in the Intelli addon system.</p>
    <textarea id="devaddon-code" class="panel-textarea" placeholder="// Your addon JS code here…"></textarea>
    <div class="panel-row">
      <input id="devaddon-name" class="panel-input" type="text" placeholder="Addon name (optional)" style="flex:1" />
      <button id="devaddon-run-btn" class="btn-primary">Inject &amp; Run</button>
    </div>
    <div id="devaddon-status" class="panel-status"></div>
    <div class="panel-section-label" style="margin-top:16px">External resources</div>
    <div class="settings-row">
      <span>Chrome Web Store</span>
      <button id="devaddon-store-btn" class="btn-primary">Open</button>
    </div>
    <div class="settings-row">
      <span>Intelli Addon Manager</span>
      <button id="devaddon-mgr-btn" class="btn-primary">Open</button>
    </div>
  </div>

  <!-- ── Onglets inactifs dropdown ─────────────────────────────── -->
  <div id="panel-inactive-tabs" class="hidden">
    <div class="ita-header">
      <div class="ita-header-left">
        <span class="ita-header-icon">&#128564;</span>
        <div>
          <span class="ita-title">Onglets inactifs</span>
          <span class="ita-subtitle" id="ita-subtitle">0 onglet inactif</span>
        </div>
      </div>
      <button class="ita-close-btn" id="inactive-panel-close">&#10005;</button>
    </div>
    <div class="ita-search-wrap">
      <input id="ita-search" class="ita-search" type="search"
             placeholder="&#128269; Filtrer les onglets&#8230;" autocomplete="off" />
    </div>
    <div id="tg-panel-list" class="tg-list"></div>
    <div class="ita-footer">
      <button id="tg-panel-restore-all" class="btn-secondary ita-footer-btn">&#8629; Tout restaurer</button>
      <button id="tg-panel-clear-all"   class="btn-danger ita-footer-btn">&#128465; Tout supprimer</button>
    </div>
  </div>

  <!-- panel backdrop (click to dismiss) -->
  <div id="panel-backdrop" class="hidden"></div>

  <!-- ── Tab group: create / rename / recolor ─────────────────── -->
  <div id="panel-tab-group" class="side-panel hidden">
    <div class="panel-header">
      <span class="panel-title" id="chg-panel-title">Nouveau groupe</span>
      <button class="panel-close" id="chg-panel-close">&#10005;</button>
    </div>
    <div class="panel-section-label">Couleur</div>
    <div class="chg-colors" id="chg-colors"></div>
    <div class="panel-section-label" style="margin-top:12px">Nom du groupe</div>
    <input id="chg-name-input" class="panel-input" type="text"
           placeholder="(optionnel)" maxlength="32" />
    <div class="panel-row" style="margin-top:14px">
      <button id="chg-cancel-btn" class="btn-secondary">Annuler</button>
      <button id="chg-save-btn"   class="btn-primary">Enregistrer</button>
    </div>
  </div>

  <!-- transparent overlay — catches clicks outside the chip ctx menu -->
  <div id="chg-ctx-overlay" class="chg-ctx-overlay hidden"></div>

  <!-- ── Tab group chip context menu (HTML dropdown) ─────────── -->
  <div id="chg-ctx" class="chg-ctx hidden">
    <div class="chg-ctx-item" id="chgctx-newtab">Nouvel onglet dans le groupe</div>
    <div class="chg-ctx-item" id="chgctx-rename">&#9998;&nbsp; Renommer</div>
    <div class="chg-ctx-item" id="chgctx-color">&#9679;&nbsp; Changer la couleur</div>
    <div class="chg-ctx-sep"></div>
    <div class="chg-ctx-item" id="chgctx-ungroup">Dégrouper</div>
    <div class="chg-ctx-item" id="chgctx-close-save-bm">&#128193;&nbsp; Fermer le groupe</div>
    <div class="chg-ctx-item chg-ctx-danger" id="chgctx-close-group">Fermer et supprimer</div>
  </div>

  <!-- ── Bookmarks bar context menu ──────────────────────────────── -->
  <div id="bm-bar-ctx-overlay" class="chg-ctx-overlay hidden"></div>
  <div id="bm-bar-ctx" class="chg-ctx hidden">
    <div class="bm-ctx-item" id="bmctx-open">Ouvrir</div>
    <div class="bm-ctx-item" id="bmctx-open-tab">Ouvrir dans un nouvel onglet</div>
    <div class="chg-ctx-sep"></div>
    <div class="bm-ctx-item" id="bmctx-edit">&#9998;&nbsp; Renommer</div>
    <div class="bm-ctx-item bm-ctx-item-danger" id="bmctx-delete">&#128465;&nbsp; Supprimer</div>
  </div>

  <script src="browser.js"></script>
</body>
</html>
